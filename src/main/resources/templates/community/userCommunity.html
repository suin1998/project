<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/userCommunity.css">
</head>
<body>
<header>
    <div class="logo">Fit Maker</div>
    <nav>
        <div class="headerBtn">
            <div id="authButtons" style="display: none;"><a href="/login">Login</a>
                <a href="/join">Join</a></div>

            <div id="logoutButtons" style="display: none;">
                <a href="/logout" id="logoutLink">Logout</a>
                <button id="MyPageButton2">My Closet</button>
            </div>
            <!--            <a href="/MyPage" onclick="return checkLogin()">My Closet</a>-->
        </div>
    </nav>
</header>

<!--<div class="layout">-->
<!--    <aside class="sidebar">-->
<!--        <button id="MainBtn">Main</button>-->
<!--        <button id="MyPageBtn">My Closet</button>-->
<!--        <button id="AICoordinatorBtn">AI Coordinator</button>-->
<!--        <div class="loginButton" style="display: none">-->
<!--            <button id="loginBtn">ë¡œê·¸ì¸</button>-->
<!--        </div>-->
<!--        <div class="logoutButton" style="display: none">-->
<!--            <button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>-->
<!--        </div>-->
<!--    </aside>-->

<div class="container">
    <div class="top-bar">
        <div class="filter-bar" id="filter-bar">
            <select id="filter-list" class="filter-list">
                <option value="latest">ìµœì‹ ìˆœ</option>
                <option value="recommend">ì¶”ì²œìˆœ</option>
                <option value="view">ì¡°íšŒìˆœ</option>
            </select>
        </div>

        <!--            <button class="newPost-btn" id="newPost">ê¸€ì“°ê¸°</button>-->
    </div>
    <div id="gallery" class="gallery">
    </div>
    <template id="gallery-item-template">
        <div class="gallery-item">
            <div class="img-box">
                <img src="" alt="">
                <div class="overlay" onclick=""></div>
            </div>
            <div class="gallery-like">
                <button type="button" class="like-btn" data-action="like">
                    ğŸ‘ <span class="like-count"></span>
                </button>
                <button type="button" class="dislike-btn" data-action="dislike">
                    ğŸ‘ <span class="dislike-count"></span>
                </button>
            </div>
        </div>
    </template>

    <div class="pagination">
        <button class="page-btn" id="prev"> <</button>
        <div id="page-numbers"></div>
        <button class="page-btn" id="next"> ></button>
    </div>
</div>
</div>

<script>
    // ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ í† í°
    const accessToken = localStorage.getItem('accessToken');
    const authButtons = document.getElementById('authButtons');
    const logoutButtons = document.getElementById('logoutButtons');

    document.addEventListener('DOMContentLoaded', function () {
        // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸ ë° ë²„íŠ¼ ì—…ë°ì´íŠ¸
        updateAuthButtons();

        // 2. ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²°
        const logoutLink = document.getElementById('logoutLink');
        if (logoutLink) {
            logoutLink.addEventListener('click', handleLogout);
        }

        // const loginButton = document.getElementById('loginBtn');
        // if (loginButton) {
        //     loginButton.addEventListener('click');
        // }
        //
        // const logoutButton = document.getElementById('logoutBtn');
        // if (logoutButton) {
        //     logoutButton.addEventListener('click');
        // }
        //
        // const MainButton = document.getElementById('MainBtn');
        // if (MainButton) {
        //     MainButton.addEventListener('click', redirectToMain);
        // }
        //
        // const AICoordinatorButton = document.getElementById('AICoordinatorBtn');
        // if (AICoordinatorButton) {
        //     AICoordinatorButton.addEventListener('click', redirectToAICoordinator);
        // }
        //
        // const MyPageButton = document.getElementById('MyPageBtn');
        // if (MyPageButton) {
        //     MyPageButton.addEventListener('click', redirectToMyPage);
        // }
    });

    // ========== ì¸ì¦ ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜ ==========
    function updateAuthButtons() {

        if (accessToken) {
            // í† í°ì´ ì¡´ì¬í•˜ë©´ (ë¡œê·¸ì¸ ìƒíƒœ)
            if (authButtons) authButtons.style.display = 'none';
            if (logoutButtons) logoutButtons.style.display = 'flex'; // í˜¹ì€ block
        } else {
            // í† í°ì´ ì—†ìœ¼ë©´ (ë¹„ë¡œê·¸ì¸ ìƒíƒœ)
            if (authButtons) authButtons.style.display = 'flex'; // í˜¹ì€ block
            if (logoutButtons) logoutButtons.style.display = 'none';
        }
    }

    // ========== ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ í•¨ìˆ˜ ==========
    function handleLogout(event) {
        event.preventDefault(); // <a> íƒœê·¸ì˜ ê¸°ë³¸ ë™ì‘(í˜ì´ì§€ ì´ë™) ë°©ì§€

        // 1. JWT í† í° ì œê±°
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');

        // 2. ë²„íŠ¼ ìƒíƒœë¥¼ ë¹„ë¡œê·¸ì¸ìœ¼ë¡œ ì—…ë°ì´íŠ¸
        updateAuthButtons();

        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');

        // 3. (ì„ íƒ) ë©”ì¸ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
        window.location.reload();
    }

    // function redirectToMain() {
    //     window.location.href = '/';
    // }
    //
    // function redirectToAICoordinator() {
    //     if (!accessToken) {
    //         window.location.href = '/login';
    //     } else {
    //         window.location.href = '/AICoordinator';
    //     }
    // }
    //
    // function redirectToMyPage() {
    //     if (!accessToken) {
    //         window.location.href = '/login';
    //     } else {
    //         window.location.href = '/MyPage';
    //     }
    // }

    // ì˜ˆì‹œ ê²Œì‹œê¸€ ë°ì´í„°
    const sampleData = Array.from({length: 30}).map((_, i) => ({
        id: i + 1,
        like: Math.floor(Math.random() * 100),
        dislike: Math.floor(Math.random() * 10),
        img: "https://picsum.photos/400?random=" + (i + 1),
        coordi: "ì—¬ê¸°ì— ì½”ë”” ì •ë³´ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤."
    }));


    // ê²Œì‹œê¸€ ë³´ì´ëŠ” í˜ì´ì§€ ê´€ë ¨
    const gallery = document.getElementById("gallery");
    const pageNumbers = document.getElementById("page-numbers");
    // ì‹œì‘ ~ ë (ì´ 14ê°œ ì¶œë ¥)
    let currentPage = 1;
    const itemsPerPage = 12;

    // ê°¤ëŸ¬ë¦¬ ì¶œë ¥
    function renderGallery() {
        gallery.innerHTML = "";

        const template = document.getElementById('gallery-item-template');

        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;

        sampleData.slice(start, end).forEach(post => {
            // í…œí”Œë¦¿ ë³µì‚¬
            const clone = template.content.cloneNode(true);

            const item = clone.querySelector('.gallery-item');
            const img = clone.querySelector('img');
            const overlay = clone.querySelector('.overlay');
            const like = clone.querySelector('.like-count');
            const dislike = clone.querySelector('.dislike-count');

            img.src = post.img;
            overlay.textContent = post.coordi;
            overlay.setAttribute('onclick', `goDetail(${post.id})`);
            like.textContent = post.like;
            dislike.textContent = post.dislike;

            gallery.appendChild(clone);
        });
        // sampleData.slice(start, end).forEach(post => {
        //     gallery.innerHTML += `
        //     <div class="gallery-item">
        //         <div class="img-box">
        //             <img src="${post.img}" alt="">
        //             <div class="overlay" onclick="goDetail(${post.id})">${post.coordi}</div>
        //         </div>
        //         <div class="gallery-info">
        //             <div class="gallery-like">ğŸ‘ ${post.like} &nbsp; ğŸ‘ ${post.dislike}</div>
        //         </div>
        // </div>`;
        // });
    }

    //ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ì´ë™
    function goDetail(id) {
        window.location.href = `/post/${id}`;
    }

    // í˜ì´ì§€ ë²„íŠ¼ ì¶œë ¥
    function renderPagination() {
        pageNumbers.innerHTML = "";
        const group = Math.floor((currentPage - 1) / 10);
        const start = group * 10 + 1;
        const end = start + 9;

        for (let i = start; i <= end; i++) {
            const span = document.createElement("span");
            span.textContent = i;
            if (i === currentPage) span.classList.add("active");

            span.onclick = () => {
                currentPage = i;
                renderEverything();
            };

            pageNumbers.appendChild(span);
        }
    }

    // prev / next ë²„íŠ¼
    document.getElementById("prev").onclick = () => {
        if (currentPage > 1) {
            currentPage--;
            renderEverything();
        }
    };

    document.getElementById("next").onclick = () => {
        currentPage++;
        renderEverything();
    };

    function renderEverything() {
        renderGallery();
        renderPagination();
    }

    renderEverything();
</script>
</body>
</html>