<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>main</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
<header>
    <div class="logo">Fit Maker</div>
    <div class="movementPage">
        <a href="/MyCloset"></a>
        <a href="/AICoordinator"></a>
        <a href="/community"></a>
    </div>
    <nav>
        <div class="headerBtn">
            <div id="authButtons" style="display: none;"><a href="/login">Login</a>
                <a href="/join">Join</a></div>

            <div id="logoutButtons" style="display: none;">
                <a href="/logout" id="logoutLink">Logout</a>
                <a href="/MyPage" onclick="return checkLogin()">My Closet</a>
<!--                <button id="MyClosetButton2">My Closet</button>-->
            </div>
        </div>
    </nav>
</header>

<section class="hero">
    <h1>홈페이지 관련 설명</h1>
    <p>관련된 설명이나 날씨같은 것을 연동해서 설명하면 좋을 것 같습니다.</p>
</section>

<section class="service">
    <div class="title">
        <h1>Service</h1>
    </div>
    <div class="container">
        <div class="card">
            <img src="/image/main/clothes_pic.jpg" alt="">
            <!--            <h2>My Closet</h2>-->
            <!--            <p>사진을 찍어 올려서 내가 가진 옷을 정리할 수 있어요.</p>-->
            <div class="btn">
                <button id="MyClosetButton">My Closet</button>
            </div>
        </div>
        <div class="card">
            <img src="/image/main/clothes.jpg" alt="">
            <!--            <h2>AI Coordinator</h2>-->
            <!--            <p>AI에게 코디를 물어볼 수 있어요.</p>-->
            <div class="btn">
                <button id="AICoordinatorButton">AI Coordinator</button>
            </div>
        </div>
        <div class="card">
            <img src="/image/main/clothes_coord.jpg" alt="">
            <!--            <h2>Community</h2>-->
            <!--            <p>내가 가진 코디를 공유하거나 다른 사람의 코디 정보를 볼 수 있어요.</p>-->
            <div class="btn">
                <button id="communityButton">Community</button>
            </div>
        </div>
    </div>
</section>
<div class="explanation">
    <div class="explanation_text">
        <h1>핏 메이커가 당신의 코디를 만들어 드립니다.</h1>
        <p>핏 메이커는 여러분들의 옷장 속 옷을 활용하여 여러분들이 원하는 지역, 날짜, 스타일, 상황에 따라 코디를 만드는 사이트입니다.
            내가 가진 옷을 활용하고 내가 가진 옷이 무엇이 있는지 확인 해보기도 하며 내가 가진 옷을 관리 할 수도 있습니다.
            내 옷을 확인 못해 비슷한 옷을 여러 벌 구매하거나 뒤늦게 옷을 사야겠다라는 생각이 들지 않으셨나요?
            <br> 핏 메이커가 이런 여러분들을 위한 관리자이자 코디네이터가 되어 줄 겁니다. AI를 활용한 코디를 활용하여 여러분들의 멋있는 스타일을 만들어 봅시다.</p>
    </div>
</div>
<div class="explanation">
    <div class="explanation_text">
        <h1>핏 메이커가 당신의 코디를 만들어 드립니다.</h1>
        <p>핏 메이커는 여러분들의 옷장 속 옷을 활용하여 여러분들이 원하는 지역, 날짜, 스타일, 상황에 따라 코디를 만드는 사이트입니다.
            내가 가진 옷을 활용하고 내가 가진 옷이 무엇이 있는지 확인 해보기도 하며 내가 가진 옷을 관리 할 수도 있습니다.
            내 옷을 확인 못해 비슷한 옷을 여러 벌 구매하거나 뒤늦게 옷을 사야겠다라는 생각이 들지 않으셨나요?
            <br> 핏 메이커가 이런 여러분들을 위한 관리자이자 코디네이터가 되어 줄 겁니다. AI를 활용한 코디를 활용하여 여러분들의 멋있는 스타일을 만들어 봅시다.</p>
    </div>
</div>
<div class="explanation">
    <div class="explanation_text">
        <h1>핏 메이커가 당신의 코디를 만들어 드립니다.</h1>
        <p>핏 메이커는 여러분들의 옷장 속 옷을 활용하여 여러분들이 원하는 지역, 날짜, 스타일, 상황에 따라 코디를 만드는 사이트입니다.
            내가 가진 옷을 활용하고 내가 가진 옷이 무엇이 있는지 확인 해보기도 하며 내가 가진 옷을 관리 할 수도 있습니다.
            내 옷을 확인 못해 비슷한 옷을 여러 벌 구매하거나 뒤늦게 옷을 사야겠다라는 생각이 들지 않으셨나요?
            <br> 핏 메이커가 이런 여러분들을 위한 관리자이자 코디네이터가 되어 줄 겁니다. AI를 활용한 코디를 활용하여 여러분들의 멋있는 스타일을 만들어 봅시다.</p>
    </div>
</div>
</body>

<script>
    // 💡 추가: 리디렉션 URL 파라미터 이름 정의 (로그인 페이지의 JS와 일치해야 함)
    const REDIRECT_PARAM_NAME = 'redirectTo';
    const VALIDATE_TOKEN_API_URL = '/auth/validate';
    const accessToken = localStorage.getItem('accessToken');
    const authButtons = document.getElementById('authButtons');
    const logoutButtons = document.getElementById('logoutButtons');

    document.addEventListener('DOMContentLoaded', function () {
        // 1. 페이지 로드 시 인증 상태 확인 및 버튼 업데이트
        updateAuthButtons();

        // 2. 이벤트 리스너 연결
        const logoutLink = document.getElementById('logoutLink');
        if (logoutLink) {
            logoutLink.addEventListener('click', handleLogout);
        }

        const communityButton = document.getElementById('communityButton');
        if (communityButton) {
            communityButton.addEventListener('click', redirectToCommunity);
        }

        const AICoordinatorButton = document.getElementById('AICoordinatorButton');
        // 💡 수정된 함수 연결
        if (AICoordinatorButton) {
            AICoordinatorButton.addEventListener('click', redirectToAICoordinator);
        }

        const MyClosetButton = document.getElementById('MyClosetButton');
        // 💡 수정된 함수 연결
        if (MyClosetButton) {
            MyClosetButton.addEventListener('click', redirectToMyCloset);
        }
    });

    // ========== 로그인 확인 및 리디렉션 로직 (추가/수정) ==========

    // 💡 추가: 지정된 경로로 이동을 시도하다가 비로그인 시 로그인 페이지로 리디렉션
    function redirectToLogin(targetPath) {
        // 목표 경로(예: /AICoordinator)를 인코딩하여 redirectTo 파라미터로 추가
        window.location.href = `/login?${REDIRECT_PARAM_NAME}=${encodeURIComponent(targetPath)}`;
        return false;
    }

    // AI Coordinator 버튼 클릭 시 (수정)
    function redirectToAICoordinator() {
        const targetPath = '/AICoordinator';
        if (!accessToken) {
            // 토큰이 없으면 AI Coordinator 경로를 가지고 로그인 페이지로 이동
            return redirectToLogin(targetPath);
        } else {
            // 토큰이 있으면 바로 AI Coordinator 페이지로 이동
            window.location.href = targetPath;
        }
    }

    // My Closet 버튼 클릭 시 (수정: MyCloset 경로를 전달)
    function redirectToMyCloset() {
        const targetPath = '/myCloset';
        if (!accessToken) {
            return redirectToLogin(targetPath);
        } else {
            window.location.href = targetPath;
        }
    }

    // 헤더의 마이클로젯 클릭 시 로그인 확인 여부 (수정: MyPage 경로를 전달)
    function checkLogin() {
        const targetPath = '/MyPage';
        if (!accessToken) {
            return redirectToLogin(targetPath);
        } else {
            // 토큰이 있으면 <a> 태그의 href="/MyPage" 동작을 따름 (혹은 명시적으로 이동)
            return true;
        }
    }

    // Community 버튼 클릭 시 (로그인이 필요 없다고 가정하고 기존 로직 유지)
    function redirectToCommunity() {
        window.location.href = '/community';
    }


    // ========== 인증 상태에 따라 버튼을 업데이트하는 핵심 함수 (기존과 동일) ==========
    function updateAuthButtons() {
        if (accessToken) {
            // 토큰이 존재하면 (로그인 상태)
            if (authButtons) authButtons.style.display = 'none';
            if (logoutButtons) logoutButtons.style.display = 'flex';
        } else {
            // 토큰이 없으면 (비로그인 상태)
            if (authButtons) authButtons.style.display = 'flex';
            if (logoutButtons) logoutButtons.style.display = 'none';
        }
    }

    // ========== 로그아웃 처리 함수 (기존과 동일) ==========
    function handleLogout(event) {
        event.preventDefault();

        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');

        updateAuthButtons();
        window.location.reload();
    }
</script>

</html>
