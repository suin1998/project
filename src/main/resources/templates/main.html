<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>main</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
<header>
    <div class="logo">Fit Maker</div>
    <nav>
        <div class="headerBtn">
            <div id="authButtons" style="display: none;"><a href="/login">Login</a>
                <a href="/join">Join</a></div>

            <div id="logoutButtons" style="display: none;">
                <a href="/logout" id="logoutLink">Logout</a>
            </div>
            <a href="/myCloset" onclick="return checkLogin()">My Closet</a>
        </div>
    </nav>
</header>

<section class="hero">
    <h1>홈페이지 관련 설명</h1>
    <p>관련된 설명이나 날씨같은 것을 연동해서 설명하면 좋을 것 같습니다.</p>
</section>

<section class="service">
    <div class="title">
        <h1>Service</h1>
    </div>
    <div class="container">
        <div class="card">
            <img src="/image/main/clothes_pic.jpg" alt="">
            <h2>My Closet</h2>
            <p>사진을 찍어 올려서 내가 가진 옷을 정리할 수 있어요.</p>
            <div class="btn">
                <button id="MyPageButton">My Closet</button>
            </div>
        </div>
        <div class="card">
            <img src="/image/main/clothes.jpg" alt="">
            <h2>AI Coordinator</h2>
            <p>AI에게 코디를 물어볼 수 있어요.</p>
            <div class="btn">
                <button id="AICoordinatorButton">AI Coordinator</button>
            </div>
        </div>
        <div class="card">
            <img src="/image/main/clothes_coord.jpg" alt="">
            <h2>Community</h2>
            <p>내가 가진 코디를 공유하거나 다른 사람의 코디 정보를 볼 수 있어요.</p>
            <div class="btn">
                <button id="communityButton">Community</button>
            </div>
        </div>
    </div>
</section>
</body>

<script>
    const accessToken = localStorage.getItem('accessToken');
    const authButtons = document.getElementById('authButtons');
    const logoutButtons = document.getElementById('logoutButtons');

    function redirectToMyCloset() {
        const accessToken = localStorage.getItem('accessToken');

        if (!accessToken) {
            // 토큰이 없으면 로그인 페이지로 안내
            alert('My Closet은 로그인 후 이용 가능합니다.');
            window.location.href = '/login';
        } else {
            // 토큰이 있으면 MyPage로 이동 시도
            window.location.href = '/myCloset';
        }
    }

    // Community 버튼 클릭 시 /community 경로로 이동합니다.
    function redirectToCommunity() {
        window.location.href = '/community';
    }

    function redirectToAICoordinator() {
        if(!accessToken) {
            window.location.href = '/login';
        } else {
        window.location.href ='/AICoordinator';
        }
    }

    function redirectToMyPage() {
        if(!accessToken) {
            window.location.href = '/login';
        } else {
            window.location.href = '/myCloset';
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        // 1. 페이지 로드 시 인증 상태 확인 및 버튼 업데이트
        updateAuthButtons();

        // 2. 로그아웃 버튼 클릭 이벤트 연결
        const logoutLink = document.getElementById('logoutLink');
        if (logoutLink) {
            logoutLink.addEventListener('click', handleLogout);
        }

        // 3. My Closet 버튼 이벤트 연결 (수정 및 정리된 부분)
        const myClosetButton = document.getElementById('myClosetButton');
        if (myClosetButton) {
            myClosetButton.addEventListener('click', redirectToMyCloset);
        }

        // 4. AI Coordinator 버튼 이벤트 연결
        const aiCoordinatorButton = document.getElementById('aiCoordinatorButton');
        if (aiCoordinatorButton) {
            aiCoordinatorButton.addEventListener('click', redirectToAICoordinator);
        }

        // 5. Community 버튼 이벤트 연결
        const communityButton = document.getElementById('communityButton');
        if (communityButton) {
            communityButton.addEventListener('click', redirectToCommunity);
        }

        const AICoordinatorButton = document.getElementById('AICoordinatorButton');
        if(AICoordinatorButton) {
            AICoordinatorButton.addEventListener('click', redirectToAICoordinator);
        }

        const MyPageButton = document.getElementById('MyPageButton');
        if(MyPageButton) {
            MyPageButton.addEventListener('click', redirectToMyPage);
        }
    });

    // ========== 인증 상태에 따라 버튼을 업데이트하는 핵심 함수 ==========
    function updateAuthButtons() {
        // 토큰 밖에 빼뒀습니다. 사유 - AI코디네이터 페이지와 마이 클로젯 페이지 이동 시 로그인 여부 확인

        if (accessToken) {
            // 토큰이 존재하면 (로그인 상태)
            if (authButtons) authButtons.style.display = 'none';
            if (logoutButtons) logoutButtons.style.display = 'flex'; // 혹은 block
        } else {
            // 토큰이 없으면 (비로그인 상태)
            if (authButtons) authButtons.style.display = 'flex'; // 혹은 block
            if (logoutButtons) logoutButtons.style.display = 'none';
        }
    }

    // ========== 로그아웃 처리 함수 ==========
    function handleLogout(event) {
        event.preventDefault(); // <a> 태그의 기본 동작(페이지 이동) 방지

        // 1. JWT 토큰 제거
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');

        // 2. 버튼 상태를 비로그인으로 업데이트
        updateAuthButtons();

        alert('로그아웃되었습니다.');

        // 3. (선택) 메인 페이지 새로고침
        window.location.reload();
    }

    // 헤더의 마이클로젯 클릭 시 로그인 확인 여부(로그인 확인이 되어있지 않을 시, 로그인 페이지로 이동)
    function checkLogin() {
        if(!accessToken) {
            window.location.href = '/login';
            return false;
        } else {
            return true;
        }
    }


</script>

</html>
